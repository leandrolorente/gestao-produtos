<div class="dashboard-container">
  <!-- Boas-vindas -->
  <div class="welcome-section">
    <div class="welcome-header">
      <div class="welcome-text">
        <h1>
          <span class="welcome-prefix">Bem-vindo de volta,</span>
          <span class="welcome-name">{{ user()?.name || 'UsuÃ¡rio' }}!</span>
        </h1>
        <p>Aqui estÃ¡ um resumo das informaÃ§Ãµes do seu sistema de gestÃ£o.</p>
      </div>
      <button
        mat-icon-button
        (click)="refreshStats()"
        [disabled]="isRefreshing()"
        matTooltip="Atualizar dados"
        class="refresh-button">
        <mat-icon [class.spinning]="isRefreshing()">refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Cards de estatÃ­sticas -->
  <div class="stats-grid" *ngIf="stats(); else loadingStats">
    <mat-card class="stat-card primary">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.totalProducts || 0 }}</h3>
            <p>Total de Produtos</p>
          </div>
          <mat-icon class="stat-icon">inventory</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card warning" [class.alert]="(stats()?.lowStockProducts || 0) > 0">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.lowStockProducts || 0 }}</h3>
            <p>Estoque Baixo</p>
          </div>
          <mat-icon class="stat-icon">warning</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card success">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ (stats()?.totalValue || 0) | currency:'BRL' }}</h3>
            <p>Valor Total do Estoque</p>
          </div>
          <mat-icon class="stat-icon">attach_money</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card info">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.totalSales || 0 }}</h3>
            <p>Total de Vendas</p>
          </div>
          <mat-icon class="stat-icon">trending_up</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card accent">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ (stats()?.totalRevenue || 0) | currency:'BRL' }}</h3>
            <p>Receita Total</p>
          </div>
          <mat-icon class="stat-icon">monetization_on</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card secondary">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.salesToday || 0 }}</h3>
            <p>Vendas Hoje</p>
          </div>
          <mat-icon class="stat-icon">today</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card primary">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.totalClients || 0 }}</h3>
            <p>Total de Clientes</p>
          </div>
          <mat-icon class="stat-icon">people</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card info">
      <mat-card-content>
        <div class="stat-content">
          <div class="stat-info">
            <h3>{{ stats()?.pendingSales || 0 }}</h3>
            <p>Vendas Pendentes</p>
          </div>
          <mat-icon class="stat-icon">pending</mat-icon>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Template de loading -->
  <ng-template #loadingStats>
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Carregando estatÃ­sticas...</p>
    </div>
  </ng-template>

  <!-- SeÃ§Ã£o de aÃ§Ãµes rÃ¡pidas e informaÃ§Ãµes -->
  <div class="content-grid">
    <!-- AÃ§Ãµes rÃ¡pidas -->
    <mat-card class="quick-actions-card">
      <mat-card-header>
        <mat-card-title>AÃ§Ãµes RÃ¡pidas</mat-card-title>
        <mat-card-subtitle>Acesse rapidamente as principais funcionalidades</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="actions-grid">
          <button
            *ngFor="let action of quickActions"
            mat-raised-button
            [color]="action.color"
            [routerLink]="action.route"
            class="action-button">
            <mat-icon>{{ action.icon }}</mat-icon>
            <div class="action-text">
              <span class="action-title">{{ action.title }}</span>
              <span class="action-description">{{ action.description }}</span>
            </div>
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Container pai para produtos e vendas -->
    <mat-card class="products-sales-container">
      <!-- Produtos mais vendidos -->
      <div class="top-products-section">
        <div class="section-header">
          <h3>Produtos Mais Vendidos</h3>
          <p>Top 3 produtos por vendas e receita</p>
        </div>
        <div class="products-list">
          <div
            *ngFor="let product of topProducts() || stats()?.topSellingProducts || []; let i = index"
            class="product-item">
            <div class="product-rank">{{ i + 1 }}</div>
            <div class="product-info">
              <h4>{{ product.name }}</h4>
              <p>{{ product.sales }} vendas â€¢ {{ (product.revenue || 0) | currency:'BRL' }} receita</p>
              <small>{{ product.quantity }} em estoque</small>
            </div>
            <div class="product-status">
              <span
                class="stock-indicator"
                [class]="getStockLevel(product.quantity)">
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Vendas recentes -->
      <div class="recent-sales-section" *ngIf="(recentSales() && recentSales()!.length > 0) || (stats()?.recentSales && stats()!.recentSales.length > 0)">
        <div class="section-header">
          <h3>ðŸ“Š Vendas Recentes</h3>
          <p>Ãšltimas transaÃ§Ãµes realizadas</p>
        </div>
        <div class="sales-list">
          <div
            *ngFor="let sale of recentSales() || stats()?.recentSales || []"
            class="sale-item">
            <div class="sale-info">
              <h4>ðŸ§¾ {{ sale.numero }}</h4>
              <p>ðŸ‘¤ {{ sale.clienteNome }}</p>
              <small>ðŸ•’ {{ sale.dataVenda | date:'dd/MM/yyyy HH:mm' }}</small>
            </div>
            <div class="sale-amount">
              <span class="amount">{{ sale.total | currency:'BRL' }}</span>
              <span class="status" [class]="sale.status.toLowerCase()">{{ sale.status }}</span>
            </div>
          </div>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Alerta de estoque baixo -->
  <mat-card *ngIf="(stats()?.lowStockProducts || 0) > 0" class="alert-card">
    <mat-card-content>
      <div class="alert-content">
        <mat-icon class="alert-icon">warning</mat-icon>
        <div class="alert-text">
          <h3>AtenÃ§Ã£o: Estoque Baixo</h3>
          <p>VocÃª tem {{ stats()?.lowStockProducts || 0 }} produto(s) com estoque baixo.
             <a routerLink="/produtos" class="alert-link">Clique aqui para verificar</a>
          </p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
