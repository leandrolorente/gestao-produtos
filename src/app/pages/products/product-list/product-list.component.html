<mat-card class="container-card">
  <mat-card-header>
    <mat-card-title>Lista de Produtos</mat-card-title>
    <mat-card-subtitle>Gerencie a entrada e saída de produtos do seu estoque</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div class="actions-header">
      <div class="import-export-buttons">
        <button mat-raised-button color="warn" (click)="triggerFileInput()" aria-label="Importar CSV" class="import-btn">
          <mat-icon>cloud_upload</mat-icon>
          Importar CSV
        </button>
        <button mat-raised-button color="accent" (click)="exportToCsv()" aria-label="Exportar para CSV" class="export-btn">
          <mat-icon>cloud_download</mat-icon>
          Exportar CSV
        </button>
      </div>
      <button mat-fab extended color="primary" (click)="openProductDialog()" aria-label="Adicionar novo produto" class="add-btn">
        <mat-icon>add</mat-icon>
        Adicionar Produto
      </button>
    </div>

    <!-- Input file hidden para importação -->
    <input #fileInput type="file" accept=".csv" (change)="onFileSelected($event)" style="display: none;" />

    <div class="desktop-view">
      <div class="mat-elevation-z8 table-container">
        <table mat-table [dataSource]="dataSource" matSort class="modern-table">

          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column"> ID </th>
            <td mat-cell *matCellDef="let element" class="id-column">
              <span class="id-badge">{{element.id}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Nome </th>
            <td mat-cell *matCellDef="let element" class="name-cell">
              <strong>{{element.name}}</strong>
            </td>
          </ng-container>

          <ng-container matColumnDef="sku">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> SKU </th>
            <td mat-cell *matCellDef="let element">
              <code class="sku-code">{{element.sku}}</code>
            </td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Estoque </th>
            <td mat-cell *matCellDef="let element">
              <span class="quantity-badge" [class.low-stock]="element.quantity < 20">
                {{element.quantity}}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Preço </th>
            <td mat-cell *matCellDef="let element">
              <span class="price-value">{{element.price | currency:'BRL'}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="lastUpdated">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> Atualizado em </th>
            <td mat-cell *matCellDef="let element">
              <span class="date-value">{{element.lastUpdated | date:'dd/MM/yyyy HH:mm'}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-column"> Ações </th>
            <td mat-cell *matCellDef="let element" class="actions-column">
              <div class="action-buttons">
                <button mat-icon-button
                        class="edit-btn"
                        matTooltip="Editar Produto"
                        (click)="openProductDialog(element)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button
                        class="delete-btn"
                        matTooltip="Excluir Produto"
                        (click)="deleteProduct(element.id)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="data-row"></tr>
        </table>
      </div>
    </div>

    <div class="mobile-view">
      @for (product of dataSource.data; track product.id) {
        <mat-card class="product-card mat-elevation-z4">
          <mat-card-header>
            <mat-card-title>{{ product.name }}</mat-card-title>
            <mat-card-subtitle>SKU: <code>{{ product.sku }}</code></mat-card-subtitle>
          </mat-card-header>
          <mat-card-content class="product-card-content">
            <div class="info-row">
              <strong>ID:</strong>
              <span class="id-badge-mobile">{{ product.id }}</span>
            </div>
            <div class="info-row">
              <strong>Estoque:</strong>
              <span class="quantity-badge" [class.low-stock]="product.quantity < 20">{{ product.quantity }}</span>
            </div>
            <div class="info-row">
              <strong>Preço:</strong>
              <span class="price-value">{{ product.price | currency:'BRL' }}</span>
            </div>
             <div class="info-row">
              <strong>Atualizado em:</strong>
              <span class="date-value">{{ product.lastUpdated | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </mat-card-content>
          <mat-card-actions align="end" class="mobile-actions">
            <button mat-icon-button
                    class="edit-btn"
                    matTooltip="Editar Produto"
                    (click)="openProductDialog(product)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button
                    class="delete-btn"
                    matTooltip="Excluir Produto"
                    (click)="deleteProduct(product.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>

  </mat-card-content>
</mat-card>
