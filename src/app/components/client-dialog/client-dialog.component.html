<div class="dialog-container">
  <div class="dialog-header">
    <h1>
      <mat-icon>{{ isEdit ? 'edit' : 'person_add' }}</mat-icon>
      {{ isEdit ? 'Editar Cliente' : 'Novo Cliente' }}
    </h1>
  </div>

  <div class="dialog-content">
    <form [formGroup]="clienteForm" class="client-form">

    <!-- Nome e Email -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nome Completo / Razão Social</mat-label>
        <input matInput formControlName="nome" placeholder="Digite o nome do cliente">
        <mat-error>{{ getFieldErrorMessage('nome') }}</mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="exemplo@email.com">
        <mat-error>{{ getFieldErrorMessage('email') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Telefone e CPF/CNPJ -->
    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Telefone</mat-label>
        <input matInput formControlName="telefone" placeholder="(00) 00000-0000"
               (input)="formatTelefone($event)">
        <mat-error>{{ getFieldErrorMessage('telefone') }}</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>CPF/CNPJ</mat-label>
        <input matInput formControlName="cpfCnpj"
               (input)="formatCpfCnpj($event)">
        <mat-error>{{ getFieldErrorMessage('cpfCnpj') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Tipo de Pessoa -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tipo de Pessoa</mat-label>
        <mat-select formControlName="tipo">
          <mat-option value="Pessoa Física">Pessoa Física</mat-option>
          <mat-option value="Pessoa Jurídica">Pessoa Jurídica</mat-option>
        </mat-select>
        <mat-error>{{ getFieldErrorMessage('tipo') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Endereço - CEP com busca automática -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>CEP</mat-label>
        <input matInput formControlName="cep" placeholder="00000-000"
               (input)="formatCep($event)" (blur)="buscarDadosCep()">
        <button matSuffix mat-icon-button type="button"
                (click)="buscarDadosCep()"
                [disabled]="buscandoCep() || !clienteForm.get('cep')?.value"
                matTooltip="Buscar CEP">
          <mat-icon *ngIf="!buscandoCep()">search</mat-icon>
          <mat-spinner *ngIf="buscandoCep()" diameter="20"></mat-spinner>
        </button>
        <mat-error>{{ getFieldErrorMessage('cep') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Logradouro e Número -->
    <div class="form-row two-columns">
      <mat-form-field appearance="outline" class="flex-grow">
        <mat-label>Logradouro</mat-label>
        <input matInput formControlName="logradouro" placeholder="Rua, Avenida, etc.">
        <mat-error>{{ getFieldErrorMessage('logradouro') }}</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="number-field">
        <mat-label>Número</mat-label>
        <input matInput formControlName="numero" placeholder="123">
        <mat-error>{{ getFieldErrorMessage('numero') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Complemento e Bairro -->
    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Complemento</mat-label>
        <input matInput formControlName="complemento" placeholder="Apto, Bloco, etc. (opcional)">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Bairro</mat-label>
        <input matInput formControlName="bairro" placeholder="Nome do bairro">
        <mat-error>{{ getFieldErrorMessage('bairro') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Estado e Cidade -->
    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="uf">
          <mat-option *ngFor="let estado of estados" [value]="estado.sigla">
            {{ estado.sigla }} - {{ estado.nome }}
          </mat-option>
        </mat-select>
        <mat-error>{{ getFieldErrorMessage('uf') }}</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Cidade</mat-label>
        <input matInput formControlName="localidade" placeholder="Nome da cidade">
        <mat-error>{{ getFieldErrorMessage('localidade') }}</mat-error>
      </mat-form-field>
    </div>

    <!-- Status Ativo -->
    <div class="form-row" *ngIf="isEdit">
      <mat-checkbox formControlName="ativo">
        Cliente Ativo
      </mat-checkbox>
    </div>

    <!-- Observações -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Observações</mat-label>
        <textarea matInput formControlName="observacoes" rows="3"
                  placeholder="Informações adicionais sobre o cliente"></textarea>
      </mat-form-field>
    </div>

    </form>
  </div>

  <div class="dialog-actions">
    <button mat-button (click)="onCancel()" class="cancel-btn">
      <mat-icon>cancel</mat-icon>
      Cancelar
    </button>
    <button mat-raised-button color="primary" (click)="onSave()"
            [disabled]="clienteForm.invalid" class="save-btn">
      <mat-icon>{{ isEdit ? 'update' : 'save' }}</mat-icon>
      {{ isEdit ? 'Atualizar' : 'Salvar' }}
    </button>
  </div>
</div>
